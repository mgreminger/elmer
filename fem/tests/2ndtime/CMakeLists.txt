
INCLUDE_DIRECTORIES(${CMAKE_BINARY_DIR}/fem/src)

ADD_LIBRARY(TimeIntegrate2 MODULE TimeIntegrate.f90)
ADD_LIBRARY(Source3 MODULE Source.f90)
SET_TARGET_PROPERTIES(TimeIntegrate2 PROPERTIES PREFIX "")
SET_TARGET_PROPERTIES(Source3 PROPERTIES PREFIX "")
SET_TARGET_PROPERTIES(Source3 PROPERTIES OUTPUT_NAME Source)
SET_TARGET_PROPERTIES(TimeIntegrate2 PROPERTIES OUTPUT_NAME TimeIntegrate)

ADD_DEPENDENCIES(TimeIntegrate2 elmersolver ElmerSolver_mpi ElmerGrid)
ADD_DEPENDENCIES(Source3 elmersolver ElmerSolver_mpi ElmerGrid)

CONFIGURE_FILE(ELMERSOLVER_STARTINFO ELMERSOLVER_STARTINFO COPYONLY)
CONFIGURE_FILE(1d.grd 1d.grd COPYONLY)
CONFIGURE_FILE(1d.sif 1d.sif COPYONLY)

ADD_TEST(NAME TimeIntegrate2
  WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR} 
  COMMAND ${CMAKE_COMMAND} -DELMERGRID_BIN=${ELMERGRID_BIN} 
  -DELMERSOLVER_BIN=${ELMERSOLVER_BIN} -DFINDNORM_BIN=${FINDNORM_BIN}
  -P ${CMAKE_CURRENT_SOURCE_DIR}/runtest.cmake)
